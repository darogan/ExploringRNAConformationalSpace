# 1 = RF00123

# rfam RF00123.afa.txt --> seq with gaps as "x"
tcsh seed2seq.csh $argv[1]
cat query.seq seed.seq > align.seq
echo aligning seed sequences
./multas > multas.log
grep seqs final.aln
grep '>' final.afa | wc -l
echo top
grep -v '>' final.afa | head
echo bot
grep -v '>' final.afa | tail
sed -i '2 d' final.afa
tcsh afa2seq.csh $argv[1]
# final.afa written to seed.seq.cut (without SEED with gaps as "x")
#
# combine and resort seed and full sequences
cat mulsel.seq seed.cut.seq | tr -d "x" > final.seq
cp skip.seed.run skip.run
./mulsel > mulsel.log
# scatter the query through the mulsel seqs (every 20)
cat final.seq | awk '{if(match($1,">")){n++; if(n==20){print "here"; n=0} print $1; }else{ print }}' > temp.seq
cat temp.seq | sed 's/^/echo "/' | sed 's/$/"/'  | sed 's/echo "here"/cat insert.seq/' > temp.csh
sed 's/SEED:/SKIP:/' query.seq > insert.seq
cp   query.seq       align.seq
tcsh temp.csh     >> align.seq
cat  insert.seq   >> align.seq
cat  seed.cut.seq >> align.seq
#
echo aligning combined sequences
./multas > multas.log
#
# strip out queries and seeds
head -2 final.afa > strip.afa
awk '{if(match($1,">")){  if(match($0,"SKIP")){skip=1}else{skip=0} }; if(skip==0){print}}' final.afa >> strip.afa
mv strip.afa final.afa
# count
grep seqs final.aln
grep '>' final.afa | wc -l
echo top
grep -v '>' final.afa | head
echo bot
grep -v '>' final.afa | tail
